# 测试计划（基于《测试用例》文档）

本文件将 `测试用例_*.md` 中的内容整理为可执行的测试步骤，供人工或脚本按表执行。

## 1. 配置管理测试

### 1.1 目标
- 验证配置文件导出、加载、验证与错误处理是否符合预期。

### 1.2 前置条件
- 操作系统：Windows 10 x64 或 Windows 11 x64
- 已构建并能运行：
  - `HardwareHook.App` 主程序
  - `HardwareHook.Tester` 测试程序

### 1.3 步骤
1. 启动 `HardwareHook.App`，打开「进程管理」标签页。
2. 在「硬件信息」标签页（后续补充界面时）或通过专用入口，读取当前硬件信息并导出 JSON 配置模板。
3. 在编辑器中手动修改导出的配置文件：
   - 修改 CPU 核心数、CPU 型号。
   - 修改硬盘序列号、MAC 地址、主板序列号。
4. 在主程序中选择修改后的配置文件。
5. 选择一个普通用户进程（如 `notepad.exe`），执行「注入Hook」。
6. 启动 `HardwareHook.Tester.exe`：
   - 执行 `HardwareHook.Tester.exe --cpu`，检查输出的核心数、型号是否与配置一致。
   - 执行 `HardwareHook.Tester.exe --disk`、`--mac`、`--bios`，检查是否与配置一致。
7. 构造错误配置文件场景：
   - 配置文件不存在：在主程序中选择一个不存在的路径。
   - JSON 格式错误：故意删掉一个大括号。
   - 字段缺失或为空：如删除 `Disk.Serial`、`Mac.Address` 等。
8. 观察主程序提示与日志文件内容。

### 1.4 通过标准
- 配置正确时：
  - 主程序提示验证通过。
  - 测试程序输出与配置文件一致。
- 配置错误或文件不存在时：
  - 主程序给出清晰错误提示（消息框 + 日志）。
  - 不执行注入操作。

## 2. DLL 注入测试

### 2.1 目标
- 验证 DLL 注入、卸载及异常场景处理是否符合设计。

### 2.2 前置条件
- 与「配置管理测试」相同，且已准备一份合法配置文件。

### 2.3 步骤
1. 正常进程注入：
   - 启动 `notepad.exe`。
   - 在主程序中选中该进程，选择合法配置文件，点击「注入Hook」。
   - 期望：注入成功，进程状态显示为「模拟中」，日志记录成功信息。
2. 不存在的进程：
   - 记录一个当前不存在的 PID（可手动输入或在代码测试中模拟）。
   - 尝试对该 PID 调用注入逻辑。
   - 期望：提示进程不存在或无法访问，并记录详细错误。
3. 权限不足的进程：
   - 在非管理员模式下运行主程序，尝试对高权限进程注入。
   - 期望：收到权限不足的错误信息（拒绝访问），日志中有详细说明。
4. 重复注入同一进程：
   - 对同一 PID 连续点击「注入Hook」。
   - 期望：第二次注入要么被拒绝，要么被安全处理，不能导致崩溃；日志中有说明。
5. 停止模拟：
   - 在「进程管理」中选中已「模拟中」的进程，点击「停止Hook」。
   - 期望：发送卸载事件成功，状态恢复为「未模拟」，日志记录卸载操作。
6. 注入失败错误处理：
   - 构造错误场景（例如手动删除输出目录下的 `HardwareHook.Core.dll`）。
   - 再次尝试注入。
   - 期望：主程序给出「未找到核心 DLL」等错误信息，日志有详细记录。

### 2.4 通过标准
- 正常场景下，目标进程可以稳定完成注入/卸载。
- 异常场景下，均有明确错误提示且不会导致主程序崩溃。

## 3. API Hook 测试

### 3.1 目标
- 验证核心 Hook（当前实现的 CPU 核心数模拟）在真实进程中的效果和稳定性。

### 3.2 步骤
1. 准备配置文件，将 `Cpu.CoreCount` 设置为一个与真实机器不同的值。
2. 启动 `HardwareHook.App`，选择配置文件，对 `HardwareHook.Tester.exe` 所在进程或目标测试进程执行「注入Hook」。
3. 运行 `HardwareHook.Tester.exe --cpu`：
   - 记录输出的「核心数」信息。
4. 长时间运行测试：
   - 保持注入状态和目标进程运行至少 30 分钟。
   - 定期执行 `HardwareHook.Tester.exe --cpu`，观察是否稳定。
5. 异常处理测试：
   - 可以临时在 Hook 回调中加入可控异常（开发阶段使用），确认异常不会导致目标进程崩溃，且日志中有记录。

### 3.3 通过标准
- 被 Hook 后的核心数输出与配置一致。
- Hook 长时间运行无崩溃，日志中无大量错误。

## 4. 进程监控与进程状态测试

### 4.1 目标
- 验证主程序对进程列表、状态展示和异常退出的处理。

### 4.2 步骤
1. 在「进程管理」页点击「刷新进程列表」，确保能看到当前所有用户进程。
2. 在过滤框中输入部分进程名，确认列表过滤生效。
3. 对一个进程注入 Hook 后，观察其状态是否变为「模拟中」。
4. 手动关闭该进程：
   - 再次刷新列表，确认状态更新为「未模拟」或进程已消失。

### 4.3 通过标准
- 列表刷新/过滤功能正常。
- Hook 状态与实际注入状态保持一致或可以通过刷新快速同步。

## 5. 日志系统测试

### 5.1 目标
- 验证基础文件日志是否按预期记录关键信息，并且不会影响性能。

### 5.2 步骤
1. 删除或备份现有日志目录（默认：`%ProgramData%\\HardwareHook\\Logs`）。
2. 执行一轮典型操作：
   - 启动主程序、刷新进程列表、选择配置、注入/卸载一次。
3. 打开日志目录，检查当日日志文件：
   - 确认日志为一行一条 JSON。
   - 包含时间戳、级别、消息、模块字段。
4. 在注入场景下多次快速操作（连续注入/卸载），观察主程序是否卡顿。

### 5.3 通过标准
- 日志文件内容结构化且信息完整。
- 高频操作下主程序依然流畅，无明显卡顿。

## 6. 稳定性与长时间运行测试

### 6.1 目标
- 验证在长时间运行和边界条件下的稳定性。

### 6.2 步骤
1. 启动一个目标进程（如自定义测试程序或常驻服务），执行注入操作。
2. 保持注入状态至少 24 小时：
   - 定期检查目标进程是否仍在运行。
   - 定期运行 `HardwareHook.Tester.exe`，确认模拟结果仍然正确。
3. 在此期间，观察：
   - 日志文件大小增长情况。
   - 目标进程和主程序的内存占用是否异常增长。

### 6.3 通过标准
- 长时间运行期间无崩溃、无明显内存泄漏。
- 模拟效果始终正确。

