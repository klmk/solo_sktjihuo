# 配置管理代码参考

## 1. 配置管理类
```csharp
/// <summary>
/// 配置管理类
/// </summary>
public class ConfigManager
{
    private static readonly object _lock = new object();
    private static HardwareConfig _config;
    private static string _configPath;
    
    /// <summary>
    /// 加载配置文件
    /// </summary>
    /// <param name="path">配置文件路径</param>
    /// <returns>硬件配置对象</returns>
    public static HardwareConfig Load(string path)
    {
        lock (_lock)
        {
            if (string.IsNullOrEmpty(path) || !File.Exists(path))
                throw new FileNotFoundException("配置文件不存在", path);
            
            try
            {
                string json = File.ReadAllText(path, Encoding.UTF8);
                var config = JsonConvert.DeserializeObject<HardwareConfig>(json);
                Validate(config);
                
                _config = config;
                _configPath = path;
                return config;
            }
            catch (Exception ex)
            {
                LogHelper.Write("加载配置文件失败: " + ex.Message);
                throw new ConfigurationException("配置文件格式错误", ex);
            }
        }
    }
    
    /// <summary>
    /// 验证配置有效性
    /// </summary>
    /// <param name="config">配置对象</param>
    public static void Validate(HardwareConfig config)
    {
        if (config == null)
            throw new ArgumentNullException(nameof(config));
        
        // 验证核心配置项
        if (config.Cpu != null && config.Cpu.CoreCount < 1)
            config.Cpu.CoreCount = 1;
        
        // 验证其他配置项...
    }
    
    /// <summary>
    /// 获取当前配置
    /// </summary>
    /// <returns>当前配置对象</returns>
    public static HardwareConfig GetCurrent()
    {
        lock (_lock)
        {
            if (_config == null && !string.IsNullOrEmpty(_configPath))
            {
                return Load(_configPath);
            }
            return _config;
        }
    }
}
```

## 2. 硬件配置类
```csharp
/// <summary>
/// 硬件配置类
/// </summary>
public class HardwareConfig
{
    /// <summary>
    /// 运行模式
    /// </summary>
    public string Mode { get; set; } = "Normal";
    
    /// <summary>
    /// CPU配置
    /// </summary>
    public CpuConfig Cpu { get; set; }
    
    /// <summary>
    /// 硬盘配置
    /// </summary>
    public DiskConfig Disk { get; set; }
    
    /// <summary>
    /// MAC地址配置
    /// </summary>
    public MacConfig Mac { get; set; }
    
    /// <summary>
    /// 主板配置
    /// </summary>
    public MotherboardConfig Motherboard { get; set; }
}

/// <summary>
/// CPU配置类
/// </summary>
public class CpuConfig
{
    /// <summary>
    /// CPU型号
    /// </summary>
    public string Model { get; set; }
    
    /// <summary>
    /// 核心数
    /// </summary>
    public int CoreCount { get; set; } = 4;
    
    /// <summary>
    /// CPU ID
    /// </summary>
    public string CpuId { get; set; }
}

/// <summary>
/// 硬盘配置类
/// </summary>
public class DiskConfig
{
    /// <summary>
    /// 序列号
    /// </summary>
    public string Serial { get; set; }
}

/// <summary>
/// MAC地址配置类
/// </summary>
public class MacConfig
{
    /// <summary>
    /// MAC地址
    /// </summary>
    public string Address { get; set; }
}

/// <summary>
/// 主板配置类
/// </summary>
public class MotherboardConfig
{
    /// <summary>
    /// 序列号
    /// </summary>
    public string Serial { get; set; }
}
```

## 3. 配置异常类
```csharp
/// <summary>
/// 配置异常类
/// </summary>
public class ConfigurationException : Exception
{
    /// <summary>
    /// 构造函数
    /// </summary>
    /// <param name="message">错误消息</param>
    public ConfigurationException(string message) : base(message)
    {}
    
    /// <summary>
    /// 构造函数
    /// </summary>
    /// <param name="message">错误消息</param>
    /// <param name="innerException">内部异常</param>
    public ConfigurationException(string message, Exception innerException) : base(message, innerException)
    {}
}
```